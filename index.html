<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Announcement System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Login Section -->
        <div id="loginSection" class="max-w-md mx-auto bg-white rounded-xl shadow-md overflow-hidden md:max-w-2xl mb-8 hidden">
            <div class="p-8">
                <div class="uppercase tracking-wide text-sm text-indigo-500 font-semibold mb-1">Admin Access</div>
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Login to Manage Announcements</h2>
                <form id="loginForm" class="space-y-4">
                    <div>
                        <label for="email" class="block text-sm font-medium text-gray-700">Email</label>
                        <input type="email" id="email" autocomplete="username" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" required>
                    </div>
                    <div>
                        <label for="password" class="block text-sm font-medium text-gray-700">Password</label>
                        <input type="password" id="password" autocomplete="current-password" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" required>
                    </div>
                    <div>
                        <button type="submit" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700">
                            Sign in
                        </button>
                    </div>
                </form>
                <div id="login-error" class="mt-4 text-red-500 text-sm"></div>
            </div>
        </div>

        <!-- Admin Panel (hidden by default) -->
        <div id="adminPanel" class="hidden">
            <div class="max-w-4xl mx-auto bg-white rounded-xl shadow-md overflow-hidden mb-8">
                <div class="p-8">
                    <div class="flex justify-between items-center mb-6">
                        <div>
                            <div class="uppercase tracking-wide text-sm text-indigo-500 font-semibold">Admin Panel</div>
                            <h2 class="text-2xl font-bold text-gray-800">Create New Announcement</h2>
                        </div>
                        <button id="logoutBtn" class="px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-md text-gray-700">
                            Logout
                        </button>
                    </div>
                    <form id="announcementForm" class="space-y-4">
                        <div>
                            <label for="title" class="block text-sm font-medium text-gray-700">Title</label>
                            <input type="text" id="title" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" required>
                        </div>
                        <div>
                            <label for="content" class="block text-sm font-medium text-gray-700">Content</label>
                            <textarea id="content" rows="4" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500" required></textarea>
                        </div>
                        <div>
                            <label for="priority" class="block text-sm font-medium text-gray-700">Priority</label>
                            <select id="priority" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                <option value="normal">Normal</option>
                                <option value="important">Important</option>
                                <option value="urgent">Urgent</option>
                            </select>
                        </div>
                        <div>
                            <button type="submit" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700">
                                Post Announcement
                            </button>
                        </div>
                    </form>
                    <div id="announcement-success" class="mt-4 text-green-500 text-sm"></div>
                </div>
            </div>
        </div>

        <!-- Public Announcements View -->
        <div id="announcementsView" class="max-w-4xl mx-auto">
            <div class="bg-white rounded-xl shadow-md overflow-hidden mb-8">
                <div class="p-8">
                    <div class="flex justify-between items-center mb-6">
                        <div class="flex items-center">
                            <div class="mr-4 w-24 h-24 bg-gray-100 rounded-lg flex items-center justify-center">
                                <img src="image/Dr. Jose Rizal.png" alt="School Logo" class="max-h-full max-w-full object-contain" />
                            </div>
                            <div>
                                <h1 class="text-3xl font-bold text-gray-800">Special Science Class Grade 7 Jose Rizal</h1>
                                <p class="text-gray-600">Francisco P. Felix Memorial National High School</p>
                            </div>
                        </div>
                        <button id="adminLoginBtn" class="px-4 py-2 bg-indigo-600 hover:bg-indigo-700 rounded-md text-white">
                            Admin Login
                        </button>
                    </div>
                    <div class="mb-6">
                        <h2 class="text-2xl font-semibold text-gray-700">Announcements</h2>
                        <p class="text-gray-500">Stay updated with the latest information</p>
                    </div>
                    <div id="announcementsList" class="space-y-6">
                        <!-- Announcements will be displayed here -->
                        <div class="text-center text-gray-400">Loading...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-6 mt-8">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0">
                    <h3 class="text-xl font-bold">Francisco P. Felix Memorial National High School</h3>
                    <p class="text-gray-300">School Year 2025-2026</p>
                </div>
                <div class="text-center md:text-right">
                    <p class="text-lg italic">"Where Excellence Matters, Inspiring Beyond"</p>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Use your actual Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCJAC5sLEwHu2cWN8emsd5ZPkoHBdGfZHs",
            authDomain: "ssc-announcements.firebaseapp.com",
            projectId: "ssc-announcements",
            storageBucket: "ssc-announcements.appspot.com",
            messagingSenderId: "389054350744",
            appId: "1:389054350744:web:1826a9102e7db316b6d7ed",
            measurementId: "G-9H6C10MK78"
        };

        // Firebase init
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // DOM Elements
        const loginSection = document.getElementById('loginSection');
        const adminPanel = document.getElementById('adminPanel');
        const announcementsView = document.getElementById('announcementsView');
        const loginForm = document.getElementById('loginForm');
        const announcementForm = document.getElementById('announcementForm');
        const logoutBtn = document.getElementById('logoutBtn');
        const adminLoginBtn = document.getElementById('adminLoginBtn');
        const announcementsList = document.getElementById('announcementsList');
        const announcementSuccess = document.getElementById('announcement-success');
        const loginError = document.getElementById('login-error');

        // UI State Functions
        function showLoginSection() {
            loginSection.classList.remove('hidden');
            adminPanel.classList.add('hidden');
            announcementsView.classList.add('hidden');
            loginError.textContent = '';
        }
        function showAdminPanel() {
            loginSection.classList.add('hidden');
            adminPanel.classList.remove('hidden');
            announcementsView.classList.remove('hidden');
        }
        function showAnnouncementsView() {
            loginSection.classList.add('hidden');
            adminPanel.classList.add('hidden');
            announcementsView.classList.remove('hidden');
        }

        // Priority color mapping
        function borderColor(priority) {
            if (priority === 'urgent') return 'border-red-500';
            if (priority === 'important') return 'border-indigo-500';
            return 'border-gray-500';
        }

        // Render Announcements
        function renderAnnouncements(snapshot) {
            announcementsList.innerHTML = '';
            if (snapshot.empty) {
                announcementsList.innerHTML = '<div class="text-center text-gray-400">No announcements posted yet.</div>';
                return;
            }
            snapshot.forEach(doc => {
                const data = doc.data();
                const date = data.timestamp ? data.timestamp.toDate().toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) : '';
                const shortContent = data.content.length > 100 ? data.content.substring(0, 100) + '...' : data.content;
                const ann = document.createElement('div');
                ann.className = `border-l-4 ${borderColor(data.priority)} pl-4 py-2 announcement-item cursor-pointer transition-all duration-200`;
                ann.innerHTML = `
                    <p class="text-xs text-gray-500">${date} • ${capitalizeFirstLetter(data.priority || 'normal')}</p>
                    <h3 class="text-xl font-semibold text-gray-800 flex items-center justify-between">
                        ${data.title}
                        <svg class="expand-icon w-5 h-5 text-gray-500 transform transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </h3>
                    <div class="announcement-content">
                        <p class="text-gray-600 mt-2 short-content">${shortContent}</p>
                        <p class="text-gray-600 mt-2 full-content hidden">${data.content}</p>
                    </div>
                `;
                announcementsList.appendChild(ann);
                ann.addEventListener('click', function() {
                    const shortContent = this.querySelector('.short-content');
                    const fullContent = this.querySelector('.full-content');
                    const expandIcon = this.querySelector('.expand-icon');
                    shortContent.classList.toggle('hidden');
                    fullContent.classList.toggle('hidden');
                    expandIcon.classList.toggle('rotate-180');
                    this.classList.toggle('bg-blue-50');
                });
            });
        }
        function capitalizeFirstLetter(string) {
            return string.charAt(0).toUpperCase() + string.slice(1);
        }

        // Fetch Announcements in realtime
       db.collection("announcements")
  .orderBy("timestamp", "desc")
  .limit(10)
  .onSnapshot(renderAnnouncements);

        // Auth UI logic
        adminLoginBtn.onclick = () => showLoginSection();
        logoutBtn.onclick = () => auth.signOut();
        loginForm.onsubmit = async (e) => {
            e.preventDefault();
            loginError.textContent = '';
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value;
            try {
                await auth.signInWithEmailAndPassword(email, password);
                loginForm.reset();
            } catch (err) {
                loginError.textContent = err.message;
            }
        };
        announcementForm.onsubmit = async (e) => {
            e.preventDefault();
            announcementSuccess.textContent = '';
            const title = document.getElementById('title').value.trim();
            const content = document.getElementById('content').value.trim();
            const priority = document.getElementById('priority').value;
            if (!title || !content) return;
            try {
                await db.collection("announcements").add({
                    title,
                    content,
                    priority,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                });
                announcementForm.reset();
                announcementSuccess.textContent = "Announcement posted!";
                setTimeout(() => { announcementSuccess.textContent = ""; }, 2000);
            } catch (err) {
                announcementSuccess.textContent = err.message;
            }
        };

        // Auth state handler
        auth.onAuthStateChanged(user => {
            if (user) showAdminPanel();
            else showAnnouncementsView();
        });

        // Init
        showAnnouncementsView();
    </script>
</body>
</html>
